<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../Assets/Logo fundo branco.png" type="image/x-icon">
    <title>Cadastro - Optimiza</title>
    <link rel="stylesheet" href="../css/cadastro.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="register-header">
            <div class="register-header-left">
                <img src="../Assets/Logo fundo branco.png" alt="Optimiza" class="register-logo">
            </div>
            <div class="register-header-right">
                <a href="Index.html" class="register-login-link">Entrar</a>
            </div>
        </div>
    <div class="register-wrapper">
        <h2 class="register-title">Cadastre-se</h2>
        <form class="register-form">
            <div class="register-row">
                <div class="register-group">
                    <label for="nome">Nome Completo</label>
                    <input type="text" id="nome" name="nome" required>
                </div>
                <div class="register-group">
                    <label for="email">E-mail</label>
                    <input type="email" id="email" name="email" required>
                </div>
            </div>
            <div class="register-row">
                <div class="register-group">
                    <label for="cpf">CPF</label>
                    <input type="text" id="cpf" name="cpf" required>
                </div>
                <div class="register-group">
                    <label for="senha">Senha</label>
                    <input type="password" id="senha" name="senha" required>
                </div>
            </div>
            <div class="register-row">
                <div class="register-group">
                    <label for="telefone">Telefone</label>
                    <input type="text" id="telefone" name="telefone" required>
                </div>
                <div class="register-group">
                    <label for="area">Área</label>
                    <select id="area" name="area" required class="register-select">
                    </select>
                </div>
            </div>
            <div class="register-row">
                <div class="register-group"></div>
                <div class="register-group">
                    <button type="submit" class="register-btn">Cadastrar</button>
                </div>
            </div>
        </form>
        <div class="register-footer">
            <span>Já tem uma conta? <a href="Index.html" class="register-footer-link">Faça o seu login</a></span>
        </div>
    </div>
    <div class="brand-footer">
        <h1 class="brand-name">Optimiza</h1>
    </div>
    <script>
        // Buscar áreas do backend e preencher o select
        async function carregarAreas() {
            try {
                //const resposta = await fetch('http://localhost:8080/optimiza/usuarios/areas');
                const resposta = await fetch('/optimiza/usuarios/areas');
                if (resposta.ok) {
                    const areas = await resposta.json();
                    const selectArea = document.getElementById('area');
                    selectArea.innerHTML = '<option value="" disabled selected>Selecione uma área</option>';
                    areas.forEach(area => {
                        selectArea.innerHTML += `<option value="${area.id}">${area.nome}</option>`;
                    });
                }
            } catch (err) {
                console.error('Erro ao carregar áreas:', err);
            }
        }
        carregarAreas();

        // Cadastro do usuário
        document.querySelector('.register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const cpf = document.getElementById('cpf').value;
            const senha = document.getElementById('senha').value;
            const telefone = document.getElementById('telefone').value;
            const idArea = document.getElementById('area').value;

            try {
                const endPointCadastro = 'http://localhost:8080/optimiza/usuarios/cadastro';
                //const endPointCadastro = '/optimiza/usuarios/cadastro';

                const resposta = await fetch(endPointCadastro, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome,
                        email,
                        senha,
                        telefone,
                        cpf,
                        idArea
                    })
                });
                if (resposta.ok) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Cadastro realizado!',
                        text: 'Redirecionando para o login...',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        window.location.href = 'Index.html';
                    });
                } else {
                    const erro = await resposta.json();
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro no cadastro',
                        text: erro.menssage || 'Erro ao cadastrar usuário.'
                    });
                }
            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro no cadastro',
                    text: 'Erro ao conectar ao servidor.'
                });
            }
        });
    </script>
</body>
</html>
