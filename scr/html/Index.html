<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../Assets/Logo fundo branco.png" type="image/x-icon">
    <title>Login - Optimiza</title>
    <link rel="stylesheet" href="../css/Index.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <div class="login-container">
        <!-- Logo à esquerda -->
        <div class="logo-section">
            <img src="../Assets/Logo fundo branco.png" alt="Optimiza" class="logo">
        </div>

        <!-- Formulário à direita -->
        <div class="form-section">
            <div class="form-header">
                <button class="create-account-btn" onclick="window.location.href='cadastro.html'">Criar Conta</button>
            </div>

            <div class="login-form-container">
                <h2>Bem vindo(a)!</h2>

                <form class="login-form" id="loginForm">
                    <div class="input-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="input-group">
                        <label for="password">Senha</label>
                        <input type="password" id="password" name="password" required>
                    </div>

                    <a href="#" class="forgot-password">Esqueceu a senha?</a>

                    <button type="submit" class="login-btn">Entrar</button>

                    <div class="signup-text">
                        <span>Não tem uma conta? </span>
                        <a href="cadastro.html" class="signup-link">Criar Conta</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Nome Optimiza no rodapé -->
    <div class="brand-footer">
        <h1 class="brand-name">Optimiza</h1>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const endPointLogin = '/optimiza/usuarios/login';
                //const endPointLogin = 'http://localhost:8080/optimiza/usuarios/login';

                const respostaLogin = await fetch(endPointLogin, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        senha: password
                    })
                });

                if (respostaLogin.ok) {
                    const json = await respostaLogin.json();
                    // Salva o id da área do usuário no localStorage
                    if (json.area && json.area.id) {
                        localStorage.setItem('idAreaUsuario', json.area.id);
                        localStorage.setItem('nomeUsuario', json.nome);
                    }
                    Swal.fire({
                        icon: 'success',
                        title: 'Login bem-sucedido!',
                        text: 'Redirecionando para a área do colaborador...',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        window.location.href = "home.html";
                    });
                } else {
                    let mensagemErro;
                    switch (respostaLogin.status) {
                        case 401:
                            mensagemErro = "Credenciais inválidas. Por favor, tente novamente.";
                            break;
                        case 404:
                            mensagemErro = "Usuário não encontrado.";
                            break;
                        default:
                            mensagemErro = `Erro inesperado: ${respostaLogin.status}`;
                    }
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro no login',
                        text: mensagemErro
                    });
                }
            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erro no login',
                    text: 'Erro ao conectar ao servidor.'
                });
            }
        });
    </script>
</body>

</html>