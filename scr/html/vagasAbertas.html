<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../Assets/Logo fundo branco.png" type="image/x-icon">
    <title>Vagas Abertas - Optimiza</title>
    <link rel="stylesheet" href="../css/vagasAbertas.css">
    <link rel="stylesheet" href="../css/menu.css">
</head>

<body>

    <!-- Menu -->
    <div class="header">
        <div class="container">
            <div class="header-left">
                <img src="../Assets/Logo fundo branco.png" alt="Optimiza" class="register-logo">
                <div class="optimiza-inicial">
                    Optimiza
                </div>
            </div>
            <div class="header-center">
                <div class="menu-text">
                    <a href="home.html">Home</a>
                </div>
                <div class="menu-container pag">
                    <button class="menu-btn menu-text">Vagas</button>
                    <div class="dropdown-content">
                        <a href="aberturaVaga.html">Abrir Vaga</a>
                        <a href="vagasAbertas.html">Vagas Abertas</a>
                    </div>
                </div>
                <div class="menu-text">
                    <a href="bancoDeTalentos.html">Banco de Talentos</a>
                </div>
                <div class="menu-text">
                    <a href="painel.html">Analítico</a>
                </div>
                <div class="menu-text">
                    <a href="http://34.195.148.77/chamado/">Ajuda</a>
                </div>
            </div>
            <div class="header-right">
                <img src="../Assets/profile.png" class="icon-profile" alt="">
                <div class="menu-profile" id="profile-name">
                    Perfil
                </div>
            </div>
        </div>
    </div>

    <!-- Conteúdo principal Listagem de vagas abertas -->
    <div class="talentos-container">
        <h2 class="talentos-title">Vagas Abertas</h2>
        <div class="talentos-actions">
            <input type="text" placeholder="Buscar" class="talentos-search">
            <button class="talentos-btn talentos-btn-search">Buscar</button>
            <button class="talentos-btn talentos-btn-filter">Filtrar</button>
        </div>
        <div class="description-table-jobs">
            <table class="table-description">
                <thead>
                    <tr>
                        <th class="description-names"><strong>Título da Vaga</strong></th>
                        <th class="description-names"><strong>Cargo</strong></th>
                        <th class="description-names"><strong>Nível de Formação</strong></th>
                        <th class="description-names"><strong>Idiomas</strong></th>
                        <th class="description-names"><strong>Área</strong></th>
                    </tr>
                </thead>
            </table>
        </div>

        <div class="talentos-list-scroll">
            <table class="talentos-table">
                <tbody id="talentos-list">
                </tbody>
            </table>
        </div>

        <!-- Modal para detalhes do candidato -->
        <div id="modal-candidato" class="modal-candidato" style="display:none;">
            <div class="modal-content">
                <span class="modal-close" id="modal-close">&times;</span>
                <h3 id="modal-nome"></h3>
                <p><strong>Nível de Formação:</strong> <span id="modal-nivel"></span></p>
                <p><strong>Curso:</strong> <span id="modal-curso"></span></p>
                <p><strong>Status:</strong> <span id="modal-status"></span></p>
            </div>
        </div>
    </div>
    </div>
<script>
    // Exibe o nome do usuário salvo no localStorage ao lado da foto de perfil
    window.addEventListener('DOMContentLoaded', function() {
        var nomeUsuario = localStorage.getItem('nomeUsuario');
        if (nomeUsuario) {
            document.getElementById('profile-name').textContent = nomeUsuario;
        }
    });
</script>
</body>

<script>
    async function carregarVagas() {
        try {
            var idArea = localStorage.getItem('idAreaUsuario');
            //const url = `http://localhost:8080/optimiza/vagas?idArea=${idArea}`;
            const url = `/optimiza/vagas?idArea=${idArea}`;
            const response = await fetch(url);
            const vagas = await response.json();

            const tbody = document.getElementById('talentos-list');
            tbody.innerHTML = '';

            function formatarTexto(texto) {
                if (!texto) return '';
                // Substitui hífens e underlines por espaço, coloca cada palavra com inicial maiúscula
                return texto.replace(/[-_]/g, ' ')
                    .split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
            }
            function formatarIdiomas(idiomas) {
                if (!Array.isArray(idiomas)) return '';
                return idiomas.map(formatarTexto).join(', ');
            }
            vagas.forEach((vaga, idx) => {
                const rowClass = idx % 2 === 0 ? 'talentos-row talentos-row-alt' : 'talentos-row talentos-row-normal';
                const tr = document.createElement('tr');
                tr.className = rowClass;
                const tituloFormatado = formatarTexto(vaga.titulo);
                const cargoFormatado = formatarTexto(vaga.cargo);
                const nivelFormatado = formatarTexto(vaga.nivelFormacao);
                const idiomasFormatados = formatarIdiomas(vaga.idiomas);
                const areaFormatada = formatarTexto(vaga.nomeArea);
                tr.innerHTML = `
                    <td class="talentos-nome"><strong>${tituloFormatado}</strong></td>
                    <td class="talentos-nome"><strong>${cargoFormatado}</strong></td>
                    <td class="talentos-nome"><strong>${nivelFormatado}</strong></td>
                    <td class="talentos-nome"><strong>${idiomasFormatados}</strong></td>
                    <td class="talentos-nome"><strong>${areaFormatada}</strong></td>
                `;
                tbody.appendChild(tr);
            });
        } catch (error) {
            console.error('Erro ao carregar vagas:', error);
        }
    }

    window.onload = function () {
        carregarVagas();
        document.getElementById('talentos-list').addEventListener('click', function (e) {
            if (e.target.classList.contains('talentos-link')) {
                e.preventDefault();
                document.getElementById('modal-nome').textContent = e.target.getAttribute('data-titulo');
                document.getElementById('modal-nivel').textContent = '';
                document.getElementById('modal-curso').textContent = e.target.getAttribute('data-cargo');
                document.getElementById('modal-status').textContent = '';
                document.getElementById('modal-candidato').style.display = 'flex';
            }
        });
        document.getElementById('modal-close').onclick = function () {
            document.getElementById('modal-candidato').style.display = 'none';
        };
        window.onclick = function (event) {
            if (event.target === document.getElementById('modal-candidato')) {
                document.getElementById('modal-candidato').style.display = 'none';
            }
        };
    };
</script>

</html>